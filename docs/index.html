<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MegaSena Analyzer</title>
<style>
:root{--gap:16px}
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:12px;color:#111}
h1{font-size:1.6rem}
nav{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0}
nav button{flex:1;min-width:120px;padding:10px;border-radius:10px;border:1px solid #aaa}
button,input,select{padding:10px;border-radius:10px;border:1px solid #bbb}
section{margin-top:16px}
.grid{display:grid;grid-template-columns:1fr;gap:var(--gap)}
.wide{grid-column:1/-1}
canvas{width:100%;height:auto;border:1px solid #ccc;border-radius:8px}
@media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>

<h1>MegaSena Analyzer</h1>
<p>Análise estatística da Mega-Sena com gráficos e gerador inteligente.</p>

<nav>
<button onclick="showTab('stats')">Estatísticas</button>
<button onclick="showTab('charts')">Gráficos</button>
<button onclick="showTab('generator')">Gerador</button>
</nav>

<section id="controls">
<input id="csvUrl" size="60" value="https://raw.githubusercontent.com/programadriano/mongodb-megasena/master/megasena.csv">
<button id="loadCsv">Carregar CSV</button>
<button id="analyze">Analisar</button>
</section>

<section id="stats" class="grid">
<div class="wide">
<h3>Classificação Estatística</h3>
<table id="topTable"></table>
</div>
</section>

<section id="charts" class="grid" style="display:none">
<div>
<h3>Frequência (10 anos)</h3>
<canvas id="barChart" width="500" height="300"></canvas>
</div>
<div>
<h3>Tendência (Top 5)</h3>
<canvas id="trendChart" width="500" height="300"></canvas>
</div>
<div class="wide">
<h3>Heatmap de Pares</h3>
<canvas id="heatmap" width="600" height="600"></canvas>
</div>
</section>

<section id="generator" style="display:none">
<h3>Gerador Inteligente</h3>
<label>Quentes <input id="qHot" type="number" value="2" min="0" max="6"></label>
<label>Mornos <input id="qWarm" type="number" value="2" min="0" max="6"></label>
<label>Frios <input id="qCold" type="number" value="2" min="0" max="6"></label><br>
<label>Pares <input id="qEven" type="number" value="3" min="0" max="6"></label>
<label>Ímpares <input id="qOdd" type="number" value="3" min="0" max="6"></label><br>
<label>Soma mín <input id="sumMin" type="number" value="80"></label>
<label>Soma máx <input id="sumMax" type="number" value="220"></label><br>
<label>Qtd jogos <input id="qty" type="number" value="1" min="1" max="20"></label><br><br>
<button id="generate">Gerar</button>
<button id="exportCsv">Exportar CSV</button>
<button id="exportJson">Exportar JSON</button>
<pre id="games"></pre>
</section>

<p style="font-size:0.9em;color:#666">Projeto educacional. Estatísticas não constituem previsão.</p>

<script>
let draws=[]; let generatedGames=[]; let worker;

function showTab(id){['stats','charts','generator'].forEach(t=>{
 document.getElementById(t).style.display=(t===id?'grid':'none');});}
showTab('stats');

if(window.Worker){ worker=new Worker('worker.js'); worker.onmessage=e=>handleWorker(e.data); }

async function loadCsv(){
 const r=await fetch(csvUrl.value); const t=await r.text();
 const l=t.split(/\r?\n/).slice(1);
 draws=l.map(x=>{const c=x.split(','); if(c.length<8) return null;
 return {d:new Date(c[1]), n:c.slice(2,8).map(Number)};}).filter(Boolean);
}

function analyze(){ if(worker) worker.postMessage({type:'analyze',draws}); }

function handleWorker(data){
 if(data.type==='stats'){ renderClassification(data.cls); renderCharts(data); }
}

function renderClassification(cls){
 let h='<tr><th>Período</th><th>Quentes</th><th>Mornos</th><th>Frios</th></tr>';
 cls.forEach(p=>{h+=`<tr><td>${p.y} anos</td><td>${p.h.join(', ')}</td><td>${p.m.join(', ')}</td><td>${p.f.join(', ')}</td></tr>`});
 topTable.innerHTML=h;
}

function renderCharts(d){ /* gráficos desenhados no worker */ }

function generateGames(){ if(worker) worker.postMessage({type:'generate',config:{
 hot:+qHot.value,warm:+qWarm.value,cold:+qCold.value,
 even:+qEven.value,odd:+qOdd.value,
 sumMin:+sumMin.value,sumMax:+sumMax.value,
 qty:+qty.value}}); }

function download(c,f,t){const a=document.createElement('a');a.href=URL.createObjectURL(new Blob([c],{type:t}));a.download=f;a.click();}

loadCsv.onclick=loadCsv; analyze.onclick=analyze; generate.onclick=generateGames;
exportCsv.onclick=()=>download(generatedGames.map((g,i)=>`Jogo ${i+1},${g.join(',')}`).join('\n'),'jogos.csv','text/csv');
exportJson.onclick=()=>download(JSON.stringify(generatedGames,null,2),'jogos.json','application/json');
</script>
</body>
</html>
