<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>MegaSena Analyzer (Estável)</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:12px}
button,input{padding:8px;margin:6px}
section{margin-top:20px}
</style>
</head>
<body>

<h1>MegaSena Analyzer – versão estável</h1>

<p><b>Passo 1:</b> selecione o arquivo CSV da Mega-Sena</p>
<input type="file" id="fileInput" accept=".csv">

<button id="analyze">Analisar</button>
<p id="status"></p>

<section>
<h3>Estatísticas (últimos 10 anos)</h3>
<table border="1" id="topTable"></table>
</section>

<section>
<h3>Gerador</h3>
<button id="generate">Gerar jogo</button>
<pre id="games"></pre>
</section>

<script>
let draws=[];
let worker=new Worker('worker.js');

worker.onmessage=e=>{
 if(e.data.type==='stats'){
  const r=e.data.result;
  topTable.innerHTML=`<tr><th>Quentes</th><th>Mornos</th><th>Frios</th></tr>
  <tr><td>${r.h.join(', ')}</td><td>${r.m.join(', ')}</td><td>${r.f.join(', ')}</td></tr>`;
 }
 if(e.data.type==='game'){
  games.textContent='Jogo: '+e.data.game.join(' - ');
 }
};

fileInput.onchange=()=>{
 const file=fileInput.files[0];
 if(!file)return;
 const reader=new FileReader();
 reader.onload=e=>{
  const t=e.target.result;
  draws=t.split(/\r?\n/).slice(1).map(l=>{
const lines = csvText.split(/\r?\n/).slice(1);

draws = lines.map(l => {
  const c = l.split(',');
  if (c.length < 8) return null;

  return {
    date: new Date(c[1]),                 // Data Sorteio
    nums: [
      Number(c[2]), Number(c[3]), Number(c[4]),
      Number(c[5]), Number(c[6]), Number(c[7])
    ]
  };
}).filter(Boolean);

}).filter(Boolean);
    if(c.length<8)return null;
    return {d:new Date(c[1]),n:c.slice(2,8).map(Number)};
  }).filter(Boolean);
  status.textContent='CSV carregado: '+draws.length+' concursos';
 };
 reader.readAsText(file);
};

analyze.onclick=()=>{
 if(!draws.length){alert('Carregue o CSV primeiro');return;}
 worker.postMessage({type:'analyze',draws});
};

generate.onclick=()=>worker.postMessage({type:'generate'});
</script>
</body>
</html>
